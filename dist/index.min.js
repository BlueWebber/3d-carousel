class Carousel3D extends HTMLElement{static attrs={overlay:"with-overlay",vertical:"vertical",itemsContainerElem:"items-container-element",rotateNegative:"rotate-negative",rawMode:"raw",debounce:"debounce-rerender",noResize:"no-resize"};static rerenderingAttrs=[this.attrs.vertical,this.attrs.rotateNegative];static observedAttributes=[this.attrs.overlay,this.attrs.vertical,this.attrs.rotateNegative,this.attrs.debounce,];static sheet=new CSSStyleSheet;static debounce=(e,t)=>{let i;return(...s)=>{clearTimeout(i),i=setTimeout(()=>{e.apply(this,s)},t)}};constructor(){super()}renderOverlay=()=>{let e=window.innerWidth,t=0,i=window.innerHeight,s=0;this.items.forEach(r=>{let n=r.getBoundingClientRect();n.left<e&&(e=n.left),n.right>t&&(t=n.right),n.bottom>s&&(s=n.bottom),n.top<i&&(i=n.top)}),this.overlay.style.width=t-e+"px",this.overlay.style.height=s-i+"px"};renderOut=()=>{let e=getComputedStyle(this.itemsContainer.children[0]),t=parseInt(e[this[this.attrs.vertical]?"height":"width"].replace(/[^0-9\.]+/g,""));this.rad=Math.tan(180*(this.numSides-2)/(2*this.numSides)*Math.PI/180)*(t/2),this.perspectiveContainer.style.perspective=this.rad+4*t+"px",this.itemsContainer.style.transformOrigin=`center center -${this.rad}px`;for(let i=0;i<this.numSides;i++){let s=this.items[i];s.style.transformOrigin=`center center -${this.rad}px`,s.style.transform=`rotate${this[this.attrs.vertical]?"X":"Y"}(${this.rotateMultiplier*i*this.rotDeg}deg)`}this.anchorElem&&(this.anchorElem.style.translate=`0px 0px -${this.rad}px`),this[this.attrs.overlay]&&this.renderOverlay()};connectedCallback(){let e=this.attachShadow({mode:"open"});e.adoptedStyleSheets=[Carousel3D.sheet],this.hasAttribute(this.attrs.rawMode)?(this.perspectiveContainer=this.querySelector("#perspective-container"),this.itemsContainer=this.querySelector("#items-container"),this.overlay=this.querySelector("#overlay"),this.items=this.itemsContainer.querySelectorAll(":scope > :not(.ignore)"),this.ignoredElems=this.itemsContainer.querySelectorAll(":scope > .ignore"),this.styleElems=this.querySelectorAll("style"),this.anchorElem=this.querySelector(".anchor"),e.append(...this.querySelectorAll(":scope > *"))):(this.items=this.querySelectorAll(":scope > :not(style, link, .ignore)"),this.ignoredElems=this.querySelectorAll(".ignore"),this.styleElems=this.querySelectorAll("style"),this.anchorElem=this.querySelector(".anchor"),this.perspectiveContainer=document.createElement("div"),this.perspectiveContainer.id="perspective-container",this.itemsContainer=document.createElement(this.getAttribute(this.attrs.itemsContainerElem)||"div"),this.itemsContainer.id="items-container",this.itemsContainer.append(...this.items,...this.ignoredElems),this.overlay=document.createElement("div"),this.overlay.id="overlay",this.replaceChildren(),this.perspectiveContainer.appendChild(this.itemsContainer),e.append(...this.styleElems,this.overlay,this.perspectiveContainer)),this.numSides=this.items.length,this.rotDeg=360/this.numSides,this.firstRender=!0,this.rotateMultiplier||(this.rotateMultiplier=1),this.renderOutDebounced||(this.renderOutDebounced=this.renderOut),this.hasAttribute(this.attrs.noResize)?this.renderOut():(this.resizeObserver=new ResizeObserver(e=>{if(this.firstRender){this.renderOut(),this.firstRender=!1;return}this.renderOutDebounced()}),this.mutationObserver=new MutationObserver(e=>{for(let t of e)"childList"===t.type&&(this.resizeObserver.disconnect(),this.items=this.itemsContainer.querySelectorAll(":scope > :not(.ignore, style, link)"),this.ignoredElems=this.itemsContainer.querySelectorAll(".ignore"),this.numSides=this.items.length,this.rotDeg=360/this.numSides,this.resizeObserver.observe(...this.items))}),this.mutationObserver.observe(this.itemsContainer,{childList:!0}),this.resizeObserver.observe(...this.items))}attributeChangedCallback(e,t,i){switch(e){case this.attrs.overlay:null!==i?(this[this.attrs.overlay]=!0,this.overlay.style.display="block",this.renderOverlay()):(this[this.attrs.overlay]=!1,this.overlay.style.display="none");break;case this.attrs.rotateNegative:this.rotateMultiplier=null!==i?-1:1;break;case this.attrs.debounce:"-1"===i?this.renderOutDebounced=()=>{}:null!==i?this.renderOutDebounced=Carousel3D.debounce(this.renderOut,parseInt(i)):this.renderOutDebounced=this.renderOut;break;default:this[e]=null!==i&&(i||!0)}this.rerenderingAttrs.includes(e)&&this.itemsContainer&&this.renderOut()}disconnectedCallback(){this.resizeObserver?.disconnect(),this.mutationObserver?.disconnect()}}Carousel3D.sheet.replaceSync(`@layer carousel-sheet{#items-container>*,#overlay{position:absolute}*{box-sizing:border-box}#items-container,#perspective-container,:host{height:100%;width:100%;display:flex;justify-content:center;align-items:center}:host{position:relative}#perspective-container{overflow:hidden}#items-container{position:relative;transform-style:preserve-3d}#overlay{z-index:1;max-height:100%;max-width:100%}}`);